(function(window){window.BC_Dialog=window.BC_Dialog||{};var plugin={};window.BC_Dialog=function(){plugin=this;var timestamp=new Date().getTime();var fn=function(){};var defaults={dropback:true,need_close:true,auto_close:false,title:"请确认",buttons:true,dialog_type:"confirm",id:"dialog-"+timestamp,wrapper:$("body"),width:"560px",height:"auto",keyboard:true,position:["center","middle"],okCallback:fn,cancelCallback:fn};var options={};plugin.settings={};if(whatType(arguments[0])=="[object string]"){options.content=arguments[0]}if(whatType(arguments[0])=="[object object]"){options=$.extend(options,arguments[0])}var _init=function(){var ps=plugin.settings=$.extend({},defaults,options),pId=ps.id||"",pClass="dialog hide ";if((/^\s*(error|success|warning|info)\s*$/).test(ps.dialog_type)){pClass+=" d-alert "+ps.dialog_type}else{if((/^\s*(confirm|alert)\s*$/).test(ps.dialog_type)){pClass+=" d-confirm"}else{pClass+=" "+ps.dialog_type}}plugin.dialog=$("<div>",{id:pId}).addClass(pClass).css({width:ps.width,height:ps.height});plugin.dialogHeader=$("<div>").addClass("d-header");plugin.dialogBody=$("<div>").addClass("d-body");plugin.dialogFooter=$("<div>").addClass("d-footer");plugin.backDrop=$("<div>").addClass("d-backdrop hide");plugin.dialog.append(plugin.dialogHeader);plugin.dialog.append(plugin.dialogBody);plugin.dialog.append(plugin.dialogFooter);if(ps.need_close){addClose(plugin)}if(ps.title){plugin.setTitle(ps.title)}plugin.setButtons();if(ps.content){plugin.setContent(ps.content)}if(ps.ajaxUrl){plugin.getAjax(ps.ajaxUrl)}if(plugin.settings.keyboard){$(document).keyup(function(e){var e=window.event||e,code=e.charCode||e.keyCode||e.which;if(code==27){plugin.close()}})}return plugin};return _init()};var whatType=function(value){var whatType=Object.prototype.toString,type=typeof value;if(null===value){return"[object null]".toLowerCase()}if("undefined"==type||"string"==type){return"[object "+type+"]".toLowerCase()}return whatType.call(value).toLowerCase()};var addClose=function(){plugin.closeBt=$("<span>",{text:"×"}).addClass("d-close");plugin.closeBt.appendTo(plugin.dialogHeader);plugin.closeBt.bind("click",function(){plugin.close()})};var addButtons=function(obj){if(whatType(obj)!=="[object array]"||obj.length==0){return false}$.each(obj,function(index,value){var btClass=(value.classes==undefined)?"d-btn d-btn-primary":value.classes,btId=(value.id==undefined)?"":value.id,button=$("<a>",{href:"javascript:;",id:btId}).addClass(btClass);if(whatType(value)=="[object string]"){button.html(value)}else{if(whatType(value)=="[object object]"){button.html(value.caption)}else{button.html("default")}}(function(plugin){button.bind("click",function(){if(value.callback!=undefined&&whatType(value.callback)=="[object function]"){value.callback(plugin.dialog)}plugin.close()})})(plugin);if((/^\s*\d+\s*$/).test(value.keyCode)){$(document).bind({keydown:function(e){var e=window.event||e,code=e.keyCode||e.which||e.charCode;if(code==parseInt(value.keyCode)){e.preventDefault()}},keyup:function(e){var e=window.event||e,code=e.keyCode||e.which||e.charCode;if(code==parseInt(value.keyCode)){e.preventDefault();button.click()}}})}button.appendTo(plugin.dialogFooter)})};Object.Equals=function(x,y){if(x===y){return true}if(!(x instanceof Object)||!(y instanceof Object)){return false}if(x.constructor!==y.constructor){return false}for(var p in x){if(x.hasOwnProperty(p)){if(!y.hasOwnProperty(p)){return false}if(x[p]===y[p]){continue}if(typeof(x[p])!=="object"){return false}if(!Object.Equals(x[p],y[p])){return false}}}for(p in y){if(y.hasOwnProperty(p)&&!x.hasOwnProperty(p)){return false}}return true};var setPosition=function(){var wrapper=(Object.Equals(plugin.settings.wrapper,$("body")))?$(window):plugin.settings.wrapper,dialog=plugin.dialog,wrapperWidth=wrapper.width(),wrapperHeight=wrapper.height(),dialogWidth=dialog.width(),dialogHeight=dialog.height(),values={left:0,top:0,right:wrapperWidth-dialogWidth,bottom:wrapperHeight-dialogHeight,center:(wrapperWidth-dialogWidth)/2,middle:(wrapperHeight-dialogHeight)/2},position=plugin.settings.position;plugin.dialog_left=undefined;plugin.dialog_top=undefined;if($.isArray(position)){var p0=position[0],p1=position[1],p_number=/^\s*\d+(\s|px)*$/i;p0_expression=/^\s*(left|right|center)\s*([\+\-]{1}\s*\d+\s*)*$/i;p1_expression=/^\s*(top|bottom|middle)\s*([\+\-]{1}\s*\d+\s*)*$/i;if(p_number.test(p0)){plugin.dialog_left=parseInt(p0)}else{if(p0_expression.test(p0)){$.each(values,function(index,value){var tmp1=p0.replace(index,value);if(tmp1!=p0){plugin.dialog_left=tmp1}})}}if(p_number.test(p1)){plugin.dialog_top=parseInt(p1)}else{if(p1_expression.test(p1)){$.each(values,function(index,value){var tmp2=p1.replace(index,value);if(tmp2!=p1){plugin.dialog_top=tmp2}})}}}plugin.dialog_left=(plugin.dialog_left!=undefined)?eval(plugin.dialog_left):values.center;plugin.dialog_top=(plugin.dialog_top!=undefined)?eval(plugin.dialog_top):values.middle;plugin.isIE6=($.browser.msie&&parseInt($.browser.version,10)==6)||false;if(plugin.isIE6){var width=$(window).width(),height=$(window).height(),scrollLeft=$(window).scrollLeft(),scrollTop=$(window).scrollTop();var ie_dialog_left=plugin.dialog_left+scrollLeft;var ie_dialog_top=plugin.dialog_top+scrollTop;if(plugin.settings.dropback){plugin.backDrop.css({width:width,height:height,left:scrollLeft,top:scrollTop})}plugin.dialog.css({left:ie_dialog_left+"px",top:ie_dialog_top+"px"});$(window).scroll(function(){var scrollLeft=$(window).scrollLeft(),scrollTop=$(window).scrollTop(),d_left=plugin.dialog_left+scrollLeft,d_top=plugin.dialog_top+scrollTop;plugin.dialog.css({left:d_left+"px",top:d_top+"px"});if(plugin.settings.dropback){plugin.backDrop.css({left:scrollLeft,top:scrollTop})}});return}plugin.dialog.css({left:plugin.dialog_left+"px",top:plugin.dialog_top+"px"})};BC_Dialog.prototype.setWidth=function(value){var val=parseInt(value);plugin.dialog.css("width",val+"px")};BC_Dialog.prototype.setHeight=function(value){var val=parseInt(value);plugin.dialog.css("height",val+"px")};BC_Dialog.prototype.setTitle=function(msg){$("<h3>",{text:msg}).appendTo(plugin.dialogHeader)};BC_Dialog.prototype.setButtons=function(buttons){var btObj;if(plugin.settings.buttons===true){if(plugin.settings.dialog_type=="confirm"){btObj=[{caption:"确定",classes:"d-btn d-btn-primary",keyCode:13,callback:plugin.settings.okCallback},{caption:"取消",classes:"d-btn",callback:plugin.settings.cancelCallback}]}else{btObj=[{caption:"确定",keyCode:13,callback:plugin.settings.okCallback}]}}else{if(plugin.settings.buttons===false){return false}else{btObj=plugin.settings.buttons}}addButtons(btObj)};BC_Dialog.prototype.setContent=function(html){plugin.dialogBody.html(html);setPosition()};BC_Dialog.prototype.getAjax=function(url){var self=plugin;$.get(url,function(data){self.dialogBody.html(data);setPosition()})};BC_Dialog.prototype.open=function(){var plugin=this;if(plugin.settings.prevOpenCallback!=undefined&&whatType(plugin.settings.prevOpenCallback)=="[object function]"){plugin.settings.prevOpenCallback(plugin.dialog)}if(plugin.settings.dropback){plugin.backDrop.removeClass("hide")}plugin.dialog.removeClass("hide");if(plugin.settings.auto_close!==false){(function(plugin){var time=parseInt(plugin.auto_close)>0?parseInt(plugin.auto_close):3000;plugin.timeout=setTimeout(function(){plugin.close()},time)})(plugin)}if(plugin.settings.dropback){plugin.settings.wrapper.append(plugin.backDrop)}plugin.settings.wrapper.append(plugin.dialog);setPosition();if(plugin.settings.openCallback!=undefined&&whatType(plugin.settings.openCallback)=="[object function]"){plugin.settings.openCallback(plugin.dialog)}};BC_Dialog.prototype.close=function(){var plugin=this;if(plugin.settings.prevCloseCallback!=undefined&&whatType(plugin.settings.prevCloseCallback)=="[object function]"){plugin.settings.prevCloseCallback(plugin.dialog)}plugin.dialog.remove();if(plugin.settings.dropback){plugin.backDrop.remove()}if(plugin.closeCallback!=undefined&&whatType(plugin.closeCallback)=="[object function]"){plugin.closeCallback(plugin.dialog)}}})(window);